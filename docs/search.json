{
  "articles": [
    {
      "path": "adjcurves.html",
      "title": "Adjusted survival curves",
      "author": [
        {
          "name": "André Moser, CTU Bern, University of Bern",
          "url": {}
        }
      ],
      "contents": "\n\nContents\nBackground\nExample\nKnowledge from the crystal ball\n\nAnalysis strategy\nDescriptive table\nUnadjusted Kaplan-Meier curve and Cox-modelling\nIPW modelling\n\nConclusion\nData simulation\n\nBackground\nUnadjusted Kaplan-Meier curves from observational data might be biased because of confounding (Cole and Hernán (2004)). This vignette introduces the concept of inverse probability (IP) weighted survival curves.\nExample\nWe consider a study population of 10,000 patients who received a medication. 60% of the patients were women. In men, a specific enzym was measured with a probability of 30%, whereas in women have a 5 times higher chance of having the enzym. Those with the enzym were more likely to receive the medication (with a probability of 75%), compared to those without the enyzm (probability of 50%).\nResearch question: What is the effect of the medication on death?\nStudy design: Cohort study\nOutcome of interest: Time to death or end of follow-up\nPredictor of interest: Medication\nConfounders: Sex, enzym\nThe used variables from the data are:\nVariable\nDefinition\nCoding\nfemale\nSex\n1=Women, 0=Men\nenzym\nMeasured enzym\n1=Present, 0=Not present\nmedi\nMedication\n1=Received, 0=Not received\ndeath\nDeath\n1=Death, 0=Alive\nfup\nFollow-up time\nNon-negative number\nKnowledge from the crystal ball\nBecause we simulated the data, we know that medication has no effect on mortality.\nAnalysis strategy\nIP weighting constructs weights which are equal to the probability of an individual’s treatment (here: receiving the medication) given observed covariates (here: sex and enzym) and creates pseudopopulations in which observed covariates are independent of treatment (i.e. no confounding) (Hernán and Robins (2022)).\n\n\n# Required packages\nlibrary(tidyverse)\nlibrary(survey)\nlibrary(survival)\nlibrary(gtsummary)\nlibrary(survminer)\n\n\n\n\n\n\nDescriptive table\nThe table below shows a descriptive summary of the study population, by medication.\n\n\ndata %>% tbl_summary(by=medi, label=list(medi ~ \"Medication\")) \n\n\n\nhtml {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#swynlxhket .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#swynlxhket .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#swynlxhket .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#swynlxhket .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#swynlxhket .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#swynlxhket .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#swynlxhket .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#swynlxhket .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#swynlxhket .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#swynlxhket .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#swynlxhket .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#swynlxhket .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#swynlxhket .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#swynlxhket .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#swynlxhket .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#swynlxhket .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#swynlxhket .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#swynlxhket .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#swynlxhket .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#swynlxhket .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#swynlxhket .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#swynlxhket .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#swynlxhket .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#swynlxhket .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#swynlxhket .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#swynlxhket .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#swynlxhket .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#swynlxhket .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#swynlxhket .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#swynlxhket .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#swynlxhket .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#swynlxhket .gt_left {\n  text-align: left;\n}\n\n#swynlxhket .gt_center {\n  text-align: center;\n}\n\n#swynlxhket .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#swynlxhket .gt_font_normal {\n  font-weight: normal;\n}\n\n#swynlxhket .gt_font_bold {\n  font-weight: bold;\n}\n\n#swynlxhket .gt_font_italic {\n  font-style: italic;\n}\n\n#swynlxhket .gt_super {\n  font-size: 65%;\n}\n\n#swynlxhket .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#swynlxhket .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#swynlxhket .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#swynlxhket .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#swynlxhket .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\nCharacteristic\n      0, N = 3,6391\n      1, N = 6,3611\n    fup\n8 (3, 17)\n6 (2, 13)death\n1,225 (34%)\n3,064 (48%)enzym\n1,321 (36%)\n3,973 (62%)female\n1,972 (54%)\n4,062 (64%)1 Median (IQR); n (%)\n    \n\nUnadjusted Kaplan-Meier curve and Cox-modelling\nA naive (unadjusted) survival analysis of the data reveals the following Kaplan-Meier plot. We conclude that the medication has an effect on survival.\n\n\nmod <- survfit(Surv(fup, death)~medi, data=data)\nggsurvplot(mod, data=data, palette=c(\"#CC0000\", \"black\"), censor=F)\n\n\n\n\n\n\nmod_cox_unadjusted <- coxph(Surv(fup, death) ~ medi, data = data)\nmod_cox_unadjusted\n\n\nCall:\ncoxph(formula = Surv(fup, death) ~ medi, data = data)\n\n        coef exp(coef) se(coef)     z      p\nmedi 0.50613   1.65887  0.03385 14.95 <2e-16\n\nLikelihood ratio test=238.4  on 1 df, p=< 2.2e-16\nn= 10000, number of events= 4289 \n\nAn unadjusted Cox proportional hazard model shows that patients with medication have 1.7 higher hazard of death compared to those without medication.\n\n\nmod_cox_adjusted <- coxph(Surv(fup, death) ~ medi+enzym+female, data = data)\nmod_cox_adjusted\n\n\nCall:\ncoxph(formula = Surv(fup, death) ~ medi + enzym + female, data = data)\n\n           coef exp(coef) se(coef)      z      p\nmedi    0.01610   1.01623  0.03445  0.467  0.640\nenzym   2.37236  10.72265  0.04703 50.441 <2e-16\nfemale  0.07087   1.07344  0.03552  1.995  0.046\n\nLikelihood ratio test=4221  on 3 df, p=< 2.2e-16\nn= 10000, number of events= 4289 \n\nWhat happens if we adjust for enzym and sex? Then the effect of the medication on death vanish (hazard ratio=1.02).\nIPW modelling\nAn IPW modelling approach construct treatment weights (here medication) given known covariates (here sex and enzym) using a logistic regression model.\n\n\n# IPW denominator\nmod <- glm(medi ~ female+enzym, data=data, family=binomial())\n\ndata$ipw <- NA\n# Probabilty of treatment\ndata$ipw <- predict(mod, data=data, type=\"response\")\n# Probabilty of non-treatment\ndata$ipw[data$medi==0] <- 1-predict(mod, data=data, type=\"response\")[data$medi==0]\n\n\n\nWe construct stabilized weights, since they can provide narrower confidence intervals (Hernán and Robins (2022)).\n\n\n# Stabilized weights\nmod0 <- glm(medi ~ 1, data=data, family=binomial())\ndata$ipw0 <- predict(mod0, data=data, type=\"response\")\ndata$ipw0[data$medi==0] <- 1-predict(mod0, data=data, type=\"response\")[data$medi==0]\ndata$ipw <- data$ipw0/data$ipw\n\n\n\nAn IPW adjusted Kaplan-Meier curve reveals that medication has no effect on survival:\n\n\n# Set survey design\nsvy_design <- svydesign(id=~1, weights=~ipw, data=data)\n\n# IPW adjusted Kaplan-Meier\nkm_fit <- svykm(Surv(fup, death) ~ medi, design=svy_design)\n\nkm_df <- data.frame(time=km_fit$`1`$time, surv=km_fit$`1`$surv, strata=\"medi=1\")\nkm_df <- bind_rows(km_df, data.frame(time=km_fit$`0`$time, surv=km_fit$`0`$surv, strata=\"medi=0\"))\nggsurvplot_df(km_df, palette=c(\"#CC0000\", \"black\"), censor=F)\n\n\n\n\n\n\nmod_cox_ipw_adjusted <- svycoxph(Surv(fup, death) ~ medi, design=svy_design)\nsummary(mod_cox_ipw_adjusted)\n\n\nIndependent Sampling design (with replacement)\nsvydesign(id = ~1, weights = ~ipw, data = data)\nCall:\nsvycoxph(formula = Surv(fup, death) ~ medi, design = svy_design)\n\n  n= 10000, number of events= 4289 \n\n        coef exp(coef) se(coef) robust se     z Pr(>|z|)\nmedi 0.01669   1.01683  0.03192   0.03323 0.502    0.616\n\n     exp(coef) exp(-coef) lower .95 upper .95\nmedi     1.017     0.9835    0.9527     1.085\n\nConcordance= 0.502  (se = 0.004 )\nLikelihood ratio test= NA  on 1 df,   p=NA\nWald test            = 0.25  on 1 df,   p=0.6\nScore (logrank) test = NA  on 1 df,   p=NA\n\n  (Note: the likelihood ratio and score tests assume independence of\n     observations within a cluster, the Wald and robust score tests do not).\n\nThis is confirmed by an IPW adjusted Cox regression model (hazard ratio=1.02).\nConclusion\nUnadjusted Kaplan-Meier curves from observational data might be biased because of confounding. IPW adjusted survival curves account for confounding by constructing weights which are proportional to the probability of treatment given known covariates. An advantage of IPW adjusted Kaplan-Meier curves is that they provide marginal survival estimates, in contrast to stratified plots (Cole and Hernán (2004)).\nData simulation\n\n\nset.seed(1)\nn <- 10000\n\n# 60% percent women\nfemale <- rbinom(n, 1, 0.6)\n# Men has the enzym with a prob of 0.3; women have\n# a 5 times higher chance of having the enzym\nenzym <- ifelse(runif(n) < plogis(qlogis(0.3)+log(5)*female), 1, 0)\n# Those with enzym receive medication with prob 0.75\nmedi <- ifelse(runif(n) < plogis(log(3)*enzym), 1, 0)\n# Hazard of dying: HR=10 of those with enyzm; No effect for medication\nhaz <- 0.01*exp(log(10)*enzym)\n# Time to death\ntime_to_death <- -log(runif(n))/haz\n# Censoring time: Mean duration 20 days\ncensored <- rweibull(n, 1, 20)\n# Follow-up time\nfup <- pmin(time_to_death, censored)\n# Death\ndeath <- ifelse(time_to_death<=censored, 1, 0)\n# Data\ndata <- data.frame(fup, death, medi, enzym, female)\n\n\n\n\n\n\nCole, Stephen R., and Miguel A. Hernán. 2004. “Adjusted Survival Curves with Inverse Probability Weights.” Computer Methods and Programs in Biomedicine 75 (1): 45–49. https://doi.org/10.1016/j.cmpb.2003.10.004.\n\n\nHernán, MA, and JM Robins. 2022. Causal Inference: What If. Boca Raton: Chapman & Hall/CRC.\n\n\n\n\n",
      "last_modified": "2022-05-06T10:47:29+02:00"
    },
    {
      "path": "immortal.html",
      "title": "Immortal time bias",
      "author": [
        {
          "name": "André Moser, CTU Bern, University of Bern",
          "url": {}
        }
      ],
      "contents": "\n\nContents\nBackground\nExample\nKnowledge from the crystal ball\n\nAnalysis strategy\nDescriptive table\n\nMethods which introduce immortal time bias\nMethod 1: Fixed group assignment at time zero\n\nMethods which might account for immortal time bias\nMethod 2: Randomly assign time zero for short group\nMethod 3: Matched treatment duration\nMethod 4: Time zero at end of treatment\nMethod 5: Time-dependent treatment\nMethod 6: Cloning\n\nConclusion\n\nBackground\nImmortal time bias might arise, if - for example - individuals are assigned to an exposure or treatment group (and on information) after time zero (Hernán et al. (2016)). Consequently, group assignment is not aligned with time zero and individuals inherently experience no outcome event for a specific time period (they are immortal when the outcome of interest is time to death). Immortal time bias is common when analyzing observational studies (Suissa (2007), Lévesque et al. (2010)). Other terminology for immortal time bias is time dependent bias or survival bias. In this vignette we introduce several methods to address immortal time bias (Zhou et al. (2005), Hernán and Robins (2016)).\nExample\nWe consider a study population of 10,000 patients admitted to an emergency unit. Patients with a more severe admission status are treated more quickly. Clinicians are interested whether the time from admission to time to treatment affect survival and group patients into two treatment groups: Short and long time to treatment after emergency admission.\nResearch question: What is the effect of the time to treatment group assignment on survival?\nStudy design: Cohort study\nOutcome of interest: Time to death or end of follow-up\nObservation time: Admission to end of follow-up\nPredictor of interest: Time to treatment after admission\nConfounders: Severity\nThe used variables from the data are:\nVariable\nDefinition\nCoding\ngroup\nGroup assignment\n0=Short (unexposed), 1=Long (exposed)\nseverity\nSeverity status\n1=Severe, 0=Non-severe\ndeath\nDeath\n1=Death, 0=Alive\nfup\nFollow-up time\nNon-negative number\nKnowledge from the crystal ball\nBecause we simulated the data, we know that group assignment has no effect on mortality.\nAnalysis strategy\nZhou et al. (2005), Karim et al. (2016), Hernán and Robins (2016) and Hernán et al. (2016) discuss different analysis strategies for addressing (or not adressing) immortal time bias. IN this vignette we summarise the investigated methods from the above mentioned articles:\nMethod\nDefinition\n1\nGroup assignment at time zero\n2\nRandom time assignment unexposed group\n3\nMatched time assignment unexposed group\n4\nTime zero at end of treatment\n5\nTime dependent treatment\n6\nCloning\n\n\n# Required packages\nlibrary(tidyverse)\nlibrary(survey)\nlibrary(survival)\nlibrary(gtsummary)\nlibrary(survminer)\n\n\n\n\n\n\nDescriptive table\nThe table below shows a descriptive summary of the study population, by group assignment.\n\n\n\n\n\ndata %>% select(!c(id, censored, time_to_death)) %>% \n  tbl_summary(by=group_lab, label=list(group ~ \"Group assignment\"))\n\n\n\nhtml {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#qjbdhijbmm .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#qjbdhijbmm .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qjbdhijbmm .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#qjbdhijbmm .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#qjbdhijbmm .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qjbdhijbmm .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qjbdhijbmm .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#qjbdhijbmm .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#qjbdhijbmm .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#qjbdhijbmm .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#qjbdhijbmm .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#qjbdhijbmm .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#qjbdhijbmm .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#qjbdhijbmm .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#qjbdhijbmm .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#qjbdhijbmm .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#qjbdhijbmm .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qjbdhijbmm .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#qjbdhijbmm .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#qjbdhijbmm .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qjbdhijbmm .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#qjbdhijbmm .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#qjbdhijbmm .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qjbdhijbmm .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qjbdhijbmm .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#qjbdhijbmm .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#qjbdhijbmm .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qjbdhijbmm .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qjbdhijbmm .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qjbdhijbmm .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qjbdhijbmm .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qjbdhijbmm .gt_left {\n  text-align: left;\n}\n\n#qjbdhijbmm .gt_center {\n  text-align: center;\n}\n\n#qjbdhijbmm .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#qjbdhijbmm .gt_font_normal {\n  font-weight: normal;\n}\n\n#qjbdhijbmm .gt_font_bold {\n  font-weight: bold;\n}\n\n#qjbdhijbmm .gt_font_italic {\n  font-style: italic;\n}\n\n#qjbdhijbmm .gt_super {\n  font-size: 65%;\n}\n\n#qjbdhijbmm .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#qjbdhijbmm .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#qjbdhijbmm .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#qjbdhijbmm .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#qjbdhijbmm .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\nCharacteristic\n      Short, N = 5,0001\n      Long, N = 5,0001\n    fup\n12 (10, 17)\n16 (13, 20)time_to_treatment\n7.74 (6.63, 8.60)\n10.66 (9.97, 11.59)death\n1,643 (33%)\n1,607 (32%)Group assignment\n0 (0%)\n5,000 (100%)severity\n3,991 (80%)\n2,221 (44%)1 Median (IQR); n (%)\n    \n\n\n\n\nMethods which introduce immortal time bias\nThis section shows two approaches which do not correct for immortal time bias (Zhou et al. (2005)).\nMethod 1: Fixed group assignment at time zero\nTime zero is time of emergency admission. Treatment is assigned according to whether patients had a short or long time to treatment.\n\n\nmod <- survfit(Surv(fup, death)~factor(group), data=data)\nggsurvplot(mod, data=data, palette=c(\"#CC0000\", \"black\"), censor=F, pval=T)\n\n\n\n\nMethods which might account for immortal time bias\nMethod 2: Randomly assign time zero for short group\nTreatment is assigned according to whether patients had a short or long time to treatment. Time zero is set at start of treatment, but time to treatment for the short group is randomly replaced by a time to treatment from the time to treatment range of the long group. Individuals from the short group who die before time zero are excluded.\n\n\ndata_method2 <- data\n# New time to treament for short group\ndata_method2$time_to_treatment_new <- data_method2$time_to_treatment\ndata_method2$time_to_treatment_new[data_method2$group==0] <- \n  runif(length(data_method2$time_to_treatment_new[data_method2$group==0]), median(time_to_treatment), max(time_to_treatment))\n\n# Exclusion of patients\ndata_method2$exclude <- 0\ndata_method2$exclude[data_method2$group==0 & data_method2$death==1] <- \n  ifelse(data_method2$fup[data_method2$group==0 & data_method2$death==1]<data_method2$time_to_treatment_new[data_method2$group==0 & data_method2$death==1], 1, 0)\n\ndata_method2 <- data_method2 %>% filter(exclude==0)\n\n# Time zero: Start of treatment\ndata_method2$fup <- pmin(data_method2$time_to_treatment_new-data_method2$time_to_treatment+data_method2$time_to_death, data_method2$time_to_treatment_new-data_method2$time_to_treatment+data_method2$censored)\n# Replace death indicator\ndata_method2$death <- ifelse(data_method2$time_to_treatment_new-data_method2$time_to_treatment+data_method2$time_to_death<=data_method2$time_to_treatment_new-data_method2$time_to_treatment+data_method2$censored, 1, 0)\n\nmod <- survfit(Surv(fup, death)~factor(group), data=data_method2)\nggsurvplot(mod, data=data_method2, palette=c(\"#CC0000\", \"black\"), censor=F, pval=T, xlab=\"Time from start of treatment\")\n\n\n\n\nMethod 3: Matched treatment duration\nTreatment is assigned according to whether patients had a short or long time to treatment. Time zero is set at start of treatment, but time to treatment for the short group is randomly replaced by a time to treatment from the time to treatment range of the long group. Individuals from the short group who die before time zero are excluded. This methods corrects for time to treatment imbalances (compared to method 2).\n\n\ndata_method4 <- data\n# Get time to treatment from long group\nsample_time <- data_method4$time_to_treatment[data_method4$group==1]\n# New time to treament for short group\ndata_method4$time_to_treatment_new <- data_method4$time_to_treatment\ndata_method4$time_to_treatment_new[data_method4$group==0] <- sample(sample_time, length(data_method4$time_to_treatment[data_method4$group==0]))\n\n# Exclusion of patients\ndata_method4$exclude <- 0\ndata_method4$exclude[data_method4$group==0 & data_method4$death==1] <- ifelse(data_method4$fup[data_method4$group==0 & data_method4$death==1]<data_method4$time_to_treatment_new[data_method4$group==0 & data_method4$death==1], 1, 0)\n\ndata_method4 <- data_method4 %>% filter(exclude==0)\n\n# Time zero: Start of treatment\ndata_method4$fup <- pmin(data_method4$time_to_treatment_new-data_method4$time_to_treatment+data_method4$time_to_death, data_method4$time_to_treatment_new-data_method4$time_to_treatment+data_method4$censored)\ndata_method4$fup <- pmin(data_method4$time_to_death, data_method4$censored)\n# Replace death indicator\ndata_method4$death <- ifelse(data_method4$time_to_treatment_new-data_method4$time_to_treatment+data_method4$time_to_death<=data_method4$time_to_treatment_new-data_method4$time_to_treatment+data_method4$censored, 1, 0)\n\nmod <- survfit(Surv(fup, death)~factor(group), data=data_method4)\nggsurvplot(mod, data=data_method4, palette=c(\"#CC0000\", \"black\"), censor=F, pval=T, xlab=\"Time from start of treatment\")\n\n\n\n\nMethod 4: Time zero at end of treatment\nTreatment is assigned according to whether patients had a short or long time to treatment. Individuals are followed-up from the end of treatment duration.\n\n\ndata_method3 <- data\ndata_method3$excluded <- ifelse(data_method3$fup<max(time_to_treatment), 1, 0)\ndata_method3 <- data_method3 %>% filter(excluded==0)\n\ndata_method3$fup <- data_method3$fup-max(time_to_treatment)\n\nmod <- survfit(Surv(fup, death)~factor(group), data=data_method3)\nggsurvplot(mod, data=data_method3, palette=c(\"#CC0000\", \"black\"), censor=F, pval=T, xlab=\"Time from end of treatment duration\")\n\n\n\n\nMethod 5: Time-dependent treatment\nTreatment assignment is 0 (“short”) as long as a patient has a time to treatment smaller than the median time to treatment, and 1 (“long”) otherwise.\n\n\nlibrary(splitstackshape)\n# For \"smoother\" curves: Fup*10\nmultiplier <- 10\ndata$fup2 <- data$fup*multiplier\ndata_discrete_surv <- expandRows(data, count=\"fup2\", drop=F) %>% arrange(id)\n# Count indicator: How many follow-up days per individuals\ndata_discrete_surv <- data_discrete_surv %>% group_by(id) %>% mutate(ind=1, time=cumsum(ind)-1)\ndata_discrete_surv$ind <- NULL\n# Maximal follow-up day\ndata_discrete_surv <- data_discrete_surv %>% group_by(id) %>% mutate(max_time=max(time))\n# Correct death\ndata_discrete_surv$death[data_discrete_surv$time < data_discrete_surv$max_time] <- 0\n# Shift days\ndata_discrete_surv <- data_discrete_surv %>% group_by(id) %>% mutate(time2=lead(time))\n# Fill last day\ndata_discrete_surv <- data_discrete_surv %>% group_by(id) %>% fill(time2)\ndata_discrete_surv$time2[data_discrete_surv$time==data_discrete_surv$max_time] <- data_discrete_surv$time2[data_discrete_surv$time==data_discrete_surv$max_time]+1\n\n# Create time-dependent treatment\ndata_discrete_surv <- data_discrete_surv %>% group_by(id) %>% mutate(group_timedependent=0)\ndata_discrete_surv$group_timedependent[data_discrete_surv$time>=data_discrete_surv$time_to_treatment*multiplier & data_discrete_surv$group==1] <- 1\n\nmod_km <- survfit(Surv(time=time/multiplier, time2=time2/multiplier, event=death)~group_timedependent, data=data_discrete_surv, cluster = id)\nggsurvplot(mod_km, data=data_discrete_surv, palette=c(\"#CC0000\", \"black\"), censor=F, pval=F, xlab=\"Time from emergency admission\")\n\n\n\n\nMethod 6: Cloning\n\n\n\nConclusion\nImmortal time bias is common in time to event analysis of observational data. In the present vignette we presented several methods for addressing immortal time bias. Similar to Zhou et al. (2005) we conclude that the investigated methods 1 and 2 do not adequately address immortal time bias. In contrast to Zhou et al. (2005) we found that method 3 did not adequatly address immortal time bias, which was also highlighted in Karim et al. (2016).\n\n\n\nHernán, Miguel A., and James M. Robins. 2016. “Using Big Data to Emulate a Target Trial When a Randomized Trial Is Not Available.” American Journal of Epidemiology 183 (8): 758–64. https://doi.org/10.1093/aje/kwv254.\n\n\nHernán, Miguel A., Brian C. Sauer, Sonia Hernández-Díaz, Robert Platt, and Ian Shrier. 2016. “Specifying a Target Trial Prevents Immortal Time Bias and Other Self-Inflicted Injuries in Observational Analyses.” Journal of Clinical Epidemiology 79: 70–75. https://doi.org/https://doi.org/10.1016/j.jclinepi.2016.04.014.\n\n\nKarim, Mohammad Ehsanul, Paul Gustafson, John Petkau, Helen Tremlett, the Long-Term Benefits, Adverse Effects of Beta-Interferon for Multiple Sclerosis (BeAMS) Study Group, Mohammad Ehsanul Karim, et al. 2016. “Comparison of Statistical Approaches for Dealing With Immortal Time Bias in Drug Effectiveness Studies.” American Journal of Epidemiology 184 (4): 325–35. https://doi.org/10.1093/aje/kwv445.\n\n\nLévesque, Linda E, James A Hanley, Abbas Kezouh, and Samy Suissa. 2010. “Problem of Immortal Time Bias in Cohort Studies: Example Using Statins for Preventing Progression of Diabetes.” BMJ 340. https://doi.org/10.1136/bmj.b5087.\n\n\nSuissa, Samy. 2007. “Immortal Time Bias in Observational Studies of Drug Effects.” Pharmacoepidemiology and Drug Safety 16 (3): 241–49. https://doi.org/https://doi.org/10.1002/pds.1357.\n\n\nZhou, Zheng, Elham Rahme, Michal Abrahamowicz, and Louise Pilote. 2005. “Survival Bias Associated with Time-to-Treatment Initiation in Drug Effectiveness Evaluation: A Comparison of Methods.” American Journal of Epidemiology 162 (10): 1016–23. https://doi.org/10.1093/aje/kwi307.\n\n\n\n\n",
      "last_modified": "2022-05-07T11:01:04+02:00"
    },
    {
      "path": "index.html",
      "title": "Vignettes",
      "description": "",
      "author": [],
      "contents": "\nClick on the upper right button for topic selection.\n\n\n\n",
      "last_modified": "2022-05-06T10:48:46+02:00"
    }
  ],
  "collections": []
}
